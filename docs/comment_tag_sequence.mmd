sequenceDiagram
  autonumber
  actor User
  participant VCW as VoiceCommentWidget
  participant APDW as ApiPhotoDisplayWidget
  participant PC as PositionConverter
  participant State as PendingMarkerState
  participant CC as CommentController
  participant CS as CommentService
  participant API as Backend API
  participant Model as Comment (locationX/Y)

  Note over VCW,State: Draft is created for text or voice comment
  User->>VCW: Create text/voice draft
  VCW->>State: Save PendingApiCommentDraft

  User->>VCW: Drag profile avatar onto photo
  VCW->>APDW: Drop (Draggable -> DragTarget)
  APDW->>APDW: globalToLocal + offset
  APDW->>PC: toRelativePosition(absolute, containerSize)
  PC-->>APDW: relativePosition (0..1)
  APDW->>State: Save PendingApiCommentMarker(relativePosition)

  User->>VCW: Tap Save
  VCW->>State: Resolve finalPosition (marker or auto)
  VCW->>CC: createTextComment / createAudioComment
  CC->>CS: createComment(locationX, locationY)
  CS->>API: POST /comments
  API-->>CS: CommentResponse
  CS-->>CC: CommentCreationResult
  CC-->>VCW: success
  VCW->>State: Clear pending draft/marker

  Note over APDW,Model: Render saved comments on photo
  APDW->>Model: Read locationX/Y
  APDW->>PC: toAbsolutePosition(relative, containerSize)
  PC-->>APDW: absolutePosition
  APDW->>APDW: clampPosition
  APDW-->>User: Show avatar tag
